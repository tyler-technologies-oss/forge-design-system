"use strict";(self.webpackChunkforge_design_system=self.webpackChunkforge_design_system||[]).push([[9328],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(n),u=o,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(k,i(i({ref:t},d),{},{components:n})):a.createElement(k,i({ref:t},d))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},25961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(87462),o=(n(67294),n(3905));const r={tags:["tcw","forge","components","npm"],authors:["ross.blakeney"]},i="Forge and package dependencies",l={permalink:"/blog/2020/05/06/package-dependencies",editUrl:"https://github.com/tyler-technologies-oss/forge-design-system/blob/main/blog/2020-05-06-package-dependencies/index.md",source:"@site/blog/2020-05-06-package-dependencies/index.md",title:"Forge and package dependencies",description:"In order to optimize Forge use, teams should avoid creating libraries from Forge components and should ensure that the components are kept up to date.",date:"2020-05-06T00:00:00.000Z",formattedDate:"May 6, 2020",tags:[{label:"tcw",permalink:"/blog/tags/tcw"},{label:"forge",permalink:"/blog/tags/forge"},{label:"components",permalink:"/blog/tags/components"},{label:"npm",permalink:"/blog/tags/npm"}],readingTime:4.055,hasTruncateMarker:!0,authors:[{name:"Ross Blakeney",title:"Lead Software Engineer",url:"https://github.com/Ross-Blakeney",imageURL:"https://github.com/Ross-Blakeney.png",key:"ross.blakeney"}],frontMatter:{tags:["tcw","forge","components","npm"],authors:["ross.blakeney"]},prevItem:{title:"Forge 2.0 Upgrade",permalink:"/blog/2022/05/02/upgrade-guide-forge-2"}},p={authorsImageUrls:[void 0]},s=[{value:"Overview",id:"overview",level:2},{value:"NPM jargon",id:"npm-jargon",level:3},{value:"Custom elements",id:"custom-elements",level:3},{value:"What not to do",id:"what-not-to-do",level:3},{value:"Why it\u2019s a problem",id:"why-its-a-problem",level:3},{value:"Peer dependencies",id:"peer-dependencies",level:2},{value:"In summary",id:"in-summary",level:2}],d={toc:s};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In order to optimize Forge use, teams should avoid creating libraries from Forge components and should ensure that the components are kept up to date. "),(0,o.kt)("admonition",{title:"TL;DR",type:"info"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"Never set Forge as a dependency of a package. Set Forge as a peer dependency only."),(0,o.kt)("li",{parentName:"ul"},"Always keep Forge within the same major version in all your apps and packages.")),(0,o.kt)("p",{parentName:"admonition"},"It's worth noting that this concept applies to ",(0,o.kt)("strong",{parentName:"p"},"any")," package that you want as a dependency of your library, but you want to allow for the consumer/dependent to control the version for compatibility with multiple versions of the library in question.")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Never list Forge in the ",(0,o.kt)("inlineCode",{parentName:"strong"},"dependencies")," array for your own library package. Use ",(0,o.kt)("inlineCode",{parentName:"strong"},"peerDependencies")," instead.")),(0,o.kt)("p",null,"There are a few key points we need to review."),(0,o.kt)("h3",{id:"npm-jargon"},"NPM jargon"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Package - any npm package. Typically, a library."),(0,o.kt)("li",{parentName:"ul"},"Dependency - an external package that will be ",(0,o.kt)("em",{parentName:"li"},"copied into your package")," at the version you specify in the ",(0,o.kt)("inlineCode",{parentName:"li"},"package.json"),"."),(0,o.kt)("li",{parentName:"ul"},"Peer dependency - an external package that must be ",(0,o.kt)("em",{parentName:"li"},"provided by the dependent"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"A peer dependency is ",(0,o.kt)("em",{parentName:"li"},"not")," copied into your package."),(0,o.kt)("li",{parentName:"ul"},"The application that your package is included in ",(0,o.kt)("strong",{parentName:"li"},"must")," provide the peer dependency.")))),(0,o.kt)("h3",{id:"custom-elements"},"Custom elements"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Custom elements are one of the three main pieces of what makes up a Web Component. Web components are at the core of Forge."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"CustomElementRegistry")," is a dictionary (useful oversimplification) of all of the custom elements registered in the browser. The custom element\u2019s name acts as the key, and the ",(0,o.kt)("inlineCode",{parentName:"li"},"class")," is the value.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"All keys/element names must be unique.")))),(0,o.kt)("h3",{id:"what-not-to-do"},"What not to do"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Let\u2019s say you created a new library package to use across a few of your apps. We\u2019ll call it ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib"),". In this example, ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," declares ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v2.0.0")," as a dependency. So ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v2.0.0")," is ",(0,o.kt)("em",{parentName:"p"},"copied")," into ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib"),"."),(0,o.kt)("p",{parentName:"admonition"},"In your app, ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp"),", you declare ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v3.5.0")," as a dependency. ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp")," also declares ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," as a dependency."),(0,o.kt)("p",{parentName:"admonition"},"This results in Forge being included in your app ",(0,o.kt)("em",{parentName:"p"},"twice"),". Once for your app at ",(0,o.kt)("inlineCode",{parentName:"p"},"v2.0.0")," and once for your library at ",(0,o.kt)("inlineCode",{parentName:"p"},"v3.5.0"),".")),(0,o.kt)("h3",{id:"why-its-a-problem"},"Why it\u2019s a problem"),(0,o.kt)("p",null,"There are several reasons you wouldn\u2019t want to do this. First of all, your application is needlessly bloated by including Forge twice. But that is outside the scope of this document. We\u2019ll focus on the issue this causes with custom elements."),(0,o.kt)("p",null,"Since ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp")," now runs with 2 copies of Forge, that means it will potentially attempt to register 2 different versions of each component in Forge. Remember the browser's ",(0,o.kt)("inlineCode",{parentName:"p"},"CustomElementRegistry")," is effectively a dictionary. So you can\u2019t register two different custom elements under the same key. So what happens is that whatever version registers first \u201cwins\u201d."),(0,o.kt)("p",null,"As an example, let\u2019s say ",(0,o.kt)("inlineCode",{parentName:"p"},"forge-selector v2.0.0")," gets registered first for ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib"),". Then later, ",(0,o.kt)("inlineCode",{parentName:"p"},"forge-selector v3.5.0")," attempts to register for ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp"),'. The key "forge-selector" is already registered, so the second registration attempt fails silently. But now ',(0,o.kt)("inlineCode",{parentName:"p"},"barApp")," is stuck with ",(0,o.kt)("inlineCode",{parentName:"p"},"forge-selector v2.0.0"),". Let\u2019s say the newer version of ",(0,o.kt)("inlineCode",{parentName:"p"},"forge-selector")," had added type-ahead functionality that we\u2019re utilizing in ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp"),". However, now that the older version registered first, anywhere we\u2019re using that new type-ahead feature is now broken with little to no leads as to what happened."),(0,o.kt)("p",null,"Hopefully, that illustrates the reason you wouldn\u2019t ever want to set Forge as a dependency of a package."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"peer-dependencies"},"Peer dependencies"),(0,o.kt)("p",null,"So how do we safely manage Forge versions?"),(0,o.kt)("p",null,"If you need to create a library that utilizes Forge, declare it as a peer dependency for the reasons mentioned above."),(0,o.kt)("p",null,"This means that your new library will need to implement Forge according to the version dictated by your dependent applications."),(0,o.kt)("p",null,"Going back to our earlier example involving ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp"),". This time, ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," declares Forge as a peer dependency."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"In this case, Forge is only included once in the application at ",(0,o.kt)("inlineCode",{parentName:"p"},"v3.5.0"),". Since it\u2019s included only once (by the application) there are no registration conflicts with any of the custom elements. But now ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," is using ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v3.5.0")," when it was originally implemented using ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v2.0.0"),". Obviously, this can still lead to breaking changes in the Forge components since ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," could be using features that no longer exist in ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v3.5.0"),".")),(0,o.kt)("p",null,"The solution is that both ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp")," need to be kept within the same major version."),(0,o.kt)("p",null,"Forge follows ",(0,o.kt)("a",{parentName:"p",href:"https://semver.org/"},"semver")," versioning practices. So we will not (intentionally) introduce any breaking changes within the same major version of Forge."),(0,o.kt)("p",null,"So if ",(0,o.kt)("inlineCode",{parentName:"p"},"fooLib")," had a ",(0,o.kt)("em",{parentName:"p"},"peer")," dependency of ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v1.0.1")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"barApp")," had a dependency of ",(0,o.kt)("inlineCode",{parentName:"p"},"Forge v3.5.0"),", there would be no breaking changes and both would work as expected."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"in-summary"},"In summary"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"When possible, avoid including ",(0,o.kt)("inlineCode",{parentName:"li"},"dependencies")," (of any kind) in your packages."),(0,o.kt)("li",{parentName:"ul"},"Use ",(0,o.kt)("inlineCode",{parentName:"li"},"peerDependencies")," where it cannot be avoided."),(0,o.kt)("li",{parentName:"ul"},"Always keep your apps and packages within the same major version of Forge.")))}m.isMDXComponent=!0}}]);